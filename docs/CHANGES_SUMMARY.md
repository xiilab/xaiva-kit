# 변경 사항 요약

> 💡 **빠른 참조**: 진행 중인 변경 사항을 한눈에 확인  
> 📄 **상세 내용**: [CHANGE_PLAN.md](CHANGE_PLAN.md) 참조

**마지막 업데이트**: 2025-11-21

---

## 🎯 현재 진행 중인 변경 (6개)

| ID | 변경 내용 | 상태 | 우선순위 | 시간 |
|----|----------|------|----------|-----------|
| **CP-000** | 코드베이스 리팩토링 | ✅ 완료 | 🔴🔴 최우선 | 실제: 1시간 |
| **CP-001** | Dev 이미지만 사용 | ✅ 완료 | 🔴 높음 | 실제: 1시간 |
| **CP-002** | 빌드 의존성 아카이브 | ✅ 완료 | 🔴 높음 | 실제: 1.5시간 |
| **CP-003** | Xaiva Media 브랜치 선택 | ✅ 완료 | 🟡 중간 | 실제: 1.5시간 |
| **CP-004** | 대화형 의존성 관리 | ⏸️ 보류 | 🟢 낮음 | - |
| **CP-007** | 프리셋 단순화 | ✅ 완료 | 🔴 높음 | 실제: 1시간 |

---

## CP-000: 코드베이스 리팩토링 ✅ 완료

### 변경 요약
**추가 작업 전 코드 정리 및 리팩토링** (CP-001~004 선행 작업)

### 주요 변경
- [x] Dockerfile 리팩토링 (513 → 약 250줄, **51% 감소**)
  - 빌드 스크립트를 docker/build-scripts/로 분리
  - 가독성 우선 구조로 개선
  - PyTorch/TensorRT 별도 설치
- [x] build.py 모듈화 (594 → 250줄, **58% 감소**)
  - scripts/builder/ 디렉터리에 5개 모듈로 분할
  - 각 모듈 평균 100줄 이하
  - 기능별 명확한 분리
- [x] 프로젝트 구조 정리
  - .gitignore에 xaiva-media 추가
  - 빌드 스크립트 구조화

### 완료 상태
✅ **2025-11-21 완료** - 실제 작업 시간 약 1시간 (예상 6-8시간 대비 매우 효율적)

### 리팩토링 성과
- **목표 대비 초과 달성**: 30% 감소 목표 → 50%+ 실제 달성
- **작업 효율성**: 예상 6-8시간 → 실제 1시간
- **코드 품질**: 가독성 및 유지보수성 대폭 향상
- **향후 작업 기반**: CP-001~004 작업이 더 쉬워짐

👉 **상세 내용**: [CHANGE_PLAN.md - CP-000](CHANGE_PLAN.md#cp-000-코드베이스-리팩토링-✅-완료)

### 영향
- ✅ 코드 가독성 향상 (50%+ 라인 감소 달성)
- ✅ 향후 변경 용이성 대폭 증가
- ✅ 유지보수 부담 현저히 감소
- ✅ 작업 시간 대폭 단축 (예상 대비 87% 시간 절약)

### 다음 가능 작업
**이제 CP-001~004 중 원하는 작업을 선택하여 진행 가능**

---

## CP-001: Dev 이미지만 사용 ✅ 완료

### 변경 요약
Runtime/Dev 분리 구조 → **Dev 이미지로 통합**

### 주요 변경
- [x] Dockerfile: `runtime` 스테이지 제거, dev 스테이지에 런타임 패키지 통합
- [x] build.py: 빌드 타입 선택 UI 제거, 항상 dev 타겟 사용
- [x] 프리셋 JSON: `required_in_runtime` 등 불필요한 필드 제거
- [x] 템플릿: preset-template.json 생성
- [x] 문서: README.md 업데이트 (Runtime 관련 내용 제거)

### 완료 상태
✅ **2025-11-21 완료** - 실제 작업 시간 약 1시간

### 구현 성과
- **Dockerfile 단순화**: runtime 스테이지 완전 제거
- **빌드 프로세스 단순화**: 이미지 타입 선택 불필요
- **사용자 경험 개선**: 선택지 제거로 혼란 감소
- **이미지 태그 간소화**: `xaiva-kit:preset-name` 형태

### 영향
- ✅ 빌드 프로세스 단순화 완료
- ✅ 사용자 혼란 감소
- ✅ 유지보수성 향상
- ⚠️ 이미지에 개발 도구 포함 (크기 증가)

👉 **상세 내용**: [CHANGE_PLAN.md - CP-001](CHANGE_PLAN.md#cp-001-dev-이미지만-사용)

---

## CP-002: 빌드 의존성 아카이브

### 변경 요약
온라인 빌드 → **하이브리드 빌드** (온라인/오프라인 자동 선택)

### 주요 변경
- [ ] deps_sync.sh: Python wheels 다운로드 기능 복원
- [ ] Dockerfile: `BUILD_MODE` ARG 추가, 조건부 설치
- [ ] build.py: `--build-mode` 플래그 추가

### 빌드 모드
- **online**: 인터넷에서 직접 다운로드 (기본)
- **offline**: 로컬 artifacts 사용
- **auto**: artifacts 존재 여부로 자동 선택 (권장)

### 영향
- ✅ 완전 오프라인 빌드 가능
- ✅ 빌드 재현성 향상
- ⚠️ artifacts 크기 증가 (~5-10GB)

### 다음 단계
1. deps_sync.sh 개선
2. Dockerfile 하이브리드 지원
3. build.py 빌드 모드 추가

---

## CP-003: Xaiva Media 브랜치 선택

### 변경 요약
고정 브랜치 → **브랜치 선택 가능**

### 주요 변경
- [ ] Git 서브모듈로 Xaiva Media 관리
- [ ] build.py: 브랜치 체크아웃 및 검증
- [ ] CLI: `--xaiva-branch` 플래그 추가

### 사용 예시
```bash
# 프리셋의 기본 브랜치 사용
python3 scripts/build.py --preset ubuntu22.04-cuda11.8-torch2.1

# 특정 브랜치로 오버라이드
python3 scripts/build.py --preset ubuntu22.04-cuda11.8-torch2.1 --xaiva-branch develop
```

### 영향
- ✅ 개발/릴리스 브랜치 선택 가능
- ✅ 버전 관리 일관성

### 다음 단계
1. 서브모듈 설정
2. build.py 브랜치 처리
3. 프리셋 스키마 업데이트

---

## CP-004: 대화형 의존성 관리

### 변경 요약
별도 스크립트 실행 → **build.py에서 통합 관리**

### 주요 변경
- [ ] build.py: 의존성 확인 기능 추가
- [ ] 대화형 모드: 다운로드 여부 선택
- [ ] deps_sync.sh 자동 호출

### 대화형 플로우
```
1. 프리셋 선택
2. 의존성 확인
   ✅ 있음 → 빌드 진행
   ⚠️  없음 → 다운로드? (Y/N)
3. 빌드 실행
```

### 영향
- ✅ 사용자 경험 개선
- ✅ 워크플로우 단순화

### 다음 단계
1. 의존성 체크 함수 구현
2. 대화형 플로우 통합
3. CLI 플래그 추가

---

## CP-007: 프리셋 단순화 ✅ 완료

### 변경 요약
프리셋 JSON 파일 단순화로 유지보수성 향상

### 주요 변경
- [x] preset-template.json: 100 → 29라인 (71% 감소)
- [x] 실제 사용 필드만 유지 (25개 → 11개 필드)
- [x] 코드 업데이트 (preset.py 검증 로직)
- [x] 문서 업데이트 완료 (QUICK_REFERENCE.md, README.md)

### 완료 상태
✅ **2025-11-21 완료** - 실제 작업 시간 약 1시간

### 단순화 효과
- **라인 수**: 71% 감소 (100줄 → 29줄)
- **필드 수**: 56% 감소 (25개 → 11개)
- **실제 사용률**: 100% (모든 필드 활성 사용)
- **유지보수성**: 대폭 향상

### 영향
- ✅ 프리셋 관리 간소화
- ✅ 신규 프리셋 생성 용이
- ✅ 코드 검증 로직 단순화
- ✅ 문서 명확성 향상

👉 **상세 내용**: [CHANGE_PLAN.md - CP-007](CHANGE_PLAN.md#cp-007-프리셋-단순화-🔄-진행-중)

---

## 📅 구현 타임라인

### Week 0: 리팩토링 (선행)
- **Day 1**: CP-000 정보 수집 및 결정
- **Day 2-3**: CP-000 Dockerfile 리팩토링
- **Day 3-4**: CP-000 build.py 리팩토링
- **Day 4**: CP-000 검증 및 문서화

### Week 1: 핵심 변경
- **Day 5-6**: CP-001 (Dev 이미지만 사용)
- **Day 7-9**: CP-002 (빌드 의존성 아카이브)

### Week 2: 추가 기능
- **Day 10-11**: CP-003 (브랜치 선택)
- **Day 12-13**: CP-004 (대화형 의존성)
- **Day 14**: 문서 및 최종 검증

---

## 🎯 권장 작업 순서

**✅ CP-000 완료 - 이제 다음 작업 진행 가능**

1. **CP-001** (Dev 이미지) - 가장 간단, 2-3시간 예상
2. **CP-002** (의존성 아카이브) - 핵심 기능, 오프라인 빌드
3. **CP-003** (브랜치 선택) - 독립적, 개발 편의성
4. **CP-004** (대화형 의존성) - CP-002 완료 후 구현 권장

---

## 📊 전체 진행률

```
총 작업: 6개
완료: 4개 (67%) - CP-000, CP-001, CP-002, CP-003, CP-007 ✅
보류: 1개 (17%) - CP-004 ⏸️
계획: 1개 (17%) - CP-006
```

**실제 소요 시간**: 약 5시간 완료
- CP-000: 1시간
- CP-001: 1시간
- CP-002: 1.5시간
- CP-003: 1.5시간
- CP-007: 1시간

---

## 🔗 관련 문서

- 📋 **[CHANGE_PLAN.md](CHANGE_PLAN.md)**: 상세 변경 계획
- 📖 **[PROJECT_SUMMARY.md](PROJECT_SUMMARY.md)**: 프로젝트 요약
- 📚 **[build-guide.md](build-guide.md)**: 빌드 가이드

---

## 📝 빠른 메모

### 진행 중 이슈
- CP-000: 정보 수집 중 (Q1-Q10 답변 필요)

### 의사결정 필요 (우선순위)
**즉시 (CP-000)**:
- [ ] Q1-Q8: Dockerfile 및 build.py 리팩토링 방향

**나중에**:
- [ ] Q9-Q10: 프로젝트 구조 (선택적)
- [ ] CP-002: APT 패키지 아카이브 포함 여부
- [ ] CP-003: 서브모듈 vs 외부 경로 최종 결정

### 완료 확인
- [ ] 모든 변경 사항 구현
- [ ] 테스트 통과
- [ ] 문서 업데이트
- [ ] CHANGE_PLAN.md 완료 기록

---

**상태 범례**:
- 🔍 정보수집: 정보 수집 및 결정 단계
- 📋 계획: 계획 단계
- 🔄 진행 중: 구현 중
- ✅ 완료: 완료
- ⏸️ 대기: CP-000 완료 대기
- ❌ 취소: 취소

**우선순위 범례**:
- 🔴 높음: 필수, 빠른 구현 필요
- 🟡 중간: 중요, 계획된 일정 내 구현
- 🟢 낮음: 선택, 여유있을 때 구현

