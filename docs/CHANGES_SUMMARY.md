# 변경 사항 요약

> 💡 **빠른 참조**: 진행 중인 변경 사항을 한눈에 확인  
> 📄 **상세 내용**: [CHANGE_PLAN.md](CHANGE_PLAN.md) 참조

**마지막 업데이트**: 2025-11-21

---

## 🎯 현재 진행 중인 변경 (5개)

| ID | 변경 내용 | 상태 | 우선순위 | 예상 시간 |
|----|----------|------|----------|-----------|
| **CP-000** | 코드베이스 리팩토링 | 🔍 정보수집 | 🔴🔴 최우선 | 6-8시간 |
| **CP-001** | Dev 이미지만 사용 | ⏸️ 대기 | 🔴 높음 | 2-3시간 |
| **CP-002** | 빌드 의존성 아카이브 | ⏸️ 대기 | 🔴 높음 | 4-6시간 |
| **CP-003** | Xaiva Media 브랜치 선택 | ⏸️ 대기 | 🟡 중간 | 2-3시간 |
| **CP-004** | 대화형 의존성 관리 | ⏸️ 대기 | 🟢 낮음 | 2-3시간 |

---

## CP-000: 코드베이스 리팩토링 (최우선)

### 변경 요약
**추가 작업 전 코드 정리 및 리팩토링** (CP-001~004 선행 작업)

### 주요 변경
- [ ] Dockerfile 리팩토링 (513 → ~350 라인)
  - 주석 코드 처리
  - RUN 명령어 분할
  - 구조 개선
- [ ] build.py 모듈화 (650 → 각 모듈 200 라인 이하)
  - 기능별 파일 분할
  - 함수 단순화
  - 에러 처리 일관성
- [ ] 프로젝트 구조 정리 (선택)
  - xaiva-media 위치
  - .gitignore 정리

### 현재 상태
🔍 **정보 수집 중** - 10개 질문에 대한 답변 필요

### 필요한 결정 사항 (10개)

#### 즉시 결정 필요 (8개)
1. **Q1**: 주석 처리된 빌드 코드 처리 (삭제/분리/유지)
2. **Q2**: Dockerfile 구조 개선 기준
3. **Q3**: Runtime/Dev 스테이지 처리 순서
4. **Q4**: Python 패키지 버전 관리 방식
5. **Q5**: build.py 모듈 분할 방식
6. **Q6**: 표준 라이브러리 제한 유지 여부
7. **Q7**: 에러 처리 일관성 확보 방법
8. **Q8**: 테스트 코드 추가 여부

#### 나중에 결정 가능 (2개)
9. **Q9**: xaiva-media 소스 관리 방식
10. **Q10**: .gitignore 설정

👉 **상세 내용**: [CHANGE_PLAN.md - CP-000](CHANGE_PLAN.md#cp-000-코드베이스-리팩토링-최우선)  
👉 **정보 체크리스트**: [REFACTORING_INFO.md](REFACTORING_INFO.md)

### 영향
- ✅ 코드 가독성 향상 (30% 라인 감소)
- ✅ 향후 변경 용이성 증가
- ✅ 유지보수 부담 감소
- ⚠️ 리팩토링 시간 필요 (6-8시간)

### 다음 단계
1. 정보 수집 체크리스트 작성
2. Q1-Q10 답변 수집
3. 리팩토링 방향 확정
4. 작업 시작

---

## CP-001: Dev 이미지만 사용

### 변경 요약
Runtime/Dev 분리 구조 → **Dev 이미지로 통합**

### 주요 변경
- [ ] Dockerfile: `runtime` 스테이지 제거
- [ ] build.py: 빌드 타입 선택 UI 제거
- [ ] 문서: Runtime 관련 내용 제거

### 영향
- ✅ 빌드 프로세스 단순화
- ⚠️ 이미지 크기 증가 (~5-10GB)

### 다음 단계
1. Dockerfile 수정
2. build.py 수정
3. 문서 업데이트

---

## CP-002: 빌드 의존성 아카이브

### 변경 요약
온라인 빌드 → **하이브리드 빌드** (온라인/오프라인 자동 선택)

### 주요 변경
- [ ] deps_sync.sh: Python wheels 다운로드 기능 복원
- [ ] Dockerfile: `BUILD_MODE` ARG 추가, 조건부 설치
- [ ] build.py: `--build-mode` 플래그 추가

### 빌드 모드
- **online**: 인터넷에서 직접 다운로드 (기본)
- **offline**: 로컬 artifacts 사용
- **auto**: artifacts 존재 여부로 자동 선택 (권장)

### 영향
- ✅ 완전 오프라인 빌드 가능
- ✅ 빌드 재현성 향상
- ⚠️ artifacts 크기 증가 (~5-10GB)

### 다음 단계
1. deps_sync.sh 개선
2. Dockerfile 하이브리드 지원
3. build.py 빌드 모드 추가

---

## CP-003: Xaiva Media 브랜치 선택

### 변경 요약
고정 브랜치 → **브랜치 선택 가능**

### 주요 변경
- [ ] Git 서브모듈로 Xaiva Media 관리
- [ ] build.py: 브랜치 체크아웃 및 검증
- [ ] CLI: `--xaiva-branch` 플래그 추가

### 사용 예시
```bash
# 프리셋의 기본 브랜치 사용
python3 scripts/build.py --preset ubuntu22.04-cuda11.8-torch2.1

# 특정 브랜치로 오버라이드
python3 scripts/build.py --preset ubuntu22.04-cuda11.8-torch2.1 --xaiva-branch develop
```

### 영향
- ✅ 개발/릴리스 브랜치 선택 가능
- ✅ 버전 관리 일관성

### 다음 단계
1. 서브모듈 설정
2. build.py 브랜치 처리
3. 프리셋 스키마 업데이트

---

## CP-004: 대화형 의존성 관리

### 변경 요약
별도 스크립트 실행 → **build.py에서 통합 관리**

### 주요 변경
- [ ] build.py: 의존성 확인 기능 추가
- [ ] 대화형 모드: 다운로드 여부 선택
- [ ] deps_sync.sh 자동 호출

### 대화형 플로우
```
1. 프리셋 선택
2. 의존성 확인
   ✅ 있음 → 빌드 진행
   ⚠️  없음 → 다운로드? (Y/N)
3. 빌드 실행
```

### 영향
- ✅ 사용자 경험 개선
- ✅ 워크플로우 단순화

### 다음 단계
1. 의존성 체크 함수 구현
2. 대화형 플로우 통합
3. CLI 플래그 추가

---

## 📅 구현 타임라인

### Week 0: 리팩토링 (선행)
- **Day 1**: CP-000 정보 수집 및 결정
- **Day 2-3**: CP-000 Dockerfile 리팩토링
- **Day 3-4**: CP-000 build.py 리팩토링
- **Day 4**: CP-000 검증 및 문서화

### Week 1: 핵심 변경
- **Day 5-6**: CP-001 (Dev 이미지만 사용)
- **Day 7-9**: CP-002 (빌드 의존성 아카이브)

### Week 2: 추가 기능
- **Day 10-11**: CP-003 (브랜치 선택)
- **Day 12-13**: CP-004 (대화형 의존성)
- **Day 14**: 문서 및 최종 검증

---

## 🎯 권장 작업 순서

**⚠️ 작업 순서 업데이트: 리팩토링 우선**

0. **CP-000** (리팩토링) - 🔴🔴 최우선, 모든 작업의 선행 조건
1. **CP-001** (Dev 이미지) - CP-000 완료 후, 가장 간단
2. **CP-002** (의존성 아카이브) - 핵심 기능, 오프라인 빌드
3. **CP-003** (브랜치 선택) - 독립적, 개발 편의성
4. **CP-004** (대화형 의존성) - CP-002 완료 후 구현 권장

---

## 📊 전체 진행률

```
총 작업: 5개
완료: 0개 (0%)
정보 수집: 1개 (20%) - CP-000
대기: 4개 (80%)
```

**예상 총 작업 시간**: 16-23시간 (리팩토링 6-8시간 + 기존 10-15시간)

---

## 🔗 관련 문서

- 📋 **[CHANGE_PLAN.md](CHANGE_PLAN.md)**: 상세 변경 계획
- 📖 **[PROJECT_SUMMARY.md](PROJECT_SUMMARY.md)**: 프로젝트 요약
- 📚 **[build-guide.md](build-guide.md)**: 빌드 가이드

---

## 📝 빠른 메모

### 진행 중 이슈
- CP-000: 정보 수집 중 (Q1-Q10 답변 필요)

### 의사결정 필요 (우선순위)
**즉시 (CP-000)**:
- [ ] Q1-Q8: Dockerfile 및 build.py 리팩토링 방향

**나중에**:
- [ ] Q9-Q10: 프로젝트 구조 (선택적)
- [ ] CP-002: APT 패키지 아카이브 포함 여부
- [ ] CP-003: 서브모듈 vs 외부 경로 최종 결정

### 완료 확인
- [ ] 모든 변경 사항 구현
- [ ] 테스트 통과
- [ ] 문서 업데이트
- [ ] CHANGE_PLAN.md 완료 기록

---

**상태 범례**:
- 🔍 정보수집: 정보 수집 및 결정 단계
- 📋 계획: 계획 단계
- 🔄 진행 중: 구현 중
- ✅ 완료: 완료
- ⏸️ 대기: CP-000 완료 대기
- ❌ 취소: 취소

**우선순위 범례**:
- 🔴 높음: 필수, 빠른 구현 필요
- 🟡 중간: 중요, 계획된 일정 내 구현
- 🟢 낮음: 선택, 여유있을 때 구현

